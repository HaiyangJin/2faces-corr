
# Relationships among effects

## Calculate holistic processing effects

```{r}
# custom function to use linear models to apply the regression method
cal_reg <- function(.data, formula, outvar){
  
  # .data: the input dataframe
  # formula: used in lm()
  # outvar: the column name for the regression effect (residuals) [new column]
  
  # perform linear regression
  lm_tmp <- lm(formula, .data)
  
  # save the residuals
  return(mutate(.data, {{outvar}} := residuals(lm_tmp))) # outvar is a variable
  # return(mutate(.data, "{outvar}" := residuals(lm_tmp))) # outvar is a string
}
```


### Part-whole task

Accuracy
```{r}
pwe_acc <- df_pw %>% 
  group_by(Subject, PW) %>% 
  summarize(acc = mean(Correct),
            .groups = "drop") %>% 
  pivot_wider(Subject, names_from = PW, values_from = acc) %>% 
  mutate(pwe_subt = whole - part) %>% # subtraction
  cal_reg(whole ~ part, pwe_regr) # regression

pwe_acc
```

RT
```{r}
pwe_rt <- df_pw %>% 
  filter(Correct) %>% 
  group_by(Subject, PW) %>% 
  summarize(rt = mean(RT),
            .groups = "drop") %>% 
  pivot_wider(Subject, names_from = PW, values_from = rt) %>% 
  mutate(pwe_subt = whole - part) %>% # subtraction
  cal_reg(whole ~ part, pwe_regr) # regression

pwe_rt
```

### Standard composite face task
Accuracy
```{r}
scfe_acc <- df_scf %>% 
  group_by(Subject, Alignment) %>% 
  summarize(acc = mean(Correct),
            .groups = "drop") %>% 
  pivot_wider(Subject, names_from = Alignment, values_from = acc) %>% 
  mutate(scfe_subt = ali - mis) %>% # subtraction
  cal_reg(ali ~ mis, scfe_regr) # regression

scfe_acc
```

RT
```{r}
scfe_rt <- df_scf %>% 
  filter(Correct) %>% 
  group_by(Subject, Alignment) %>% 
  summarize(rt = mean(RT),
            .groups = "drop") %>% 
  pivot_wider(Subject, names_from = Alignment, values_from = rt) %>% 
  mutate(scfe_subt = ali - mis) %>% # subtraction
  cal_reg(ali ~ mis, scfe_regr) # regression

scfe_rt
```

### Complete composite face task
Sensitivity d'
```{r}
ccfe_d <- df_ccf_iso %>% 
  group_by(Subject, Congruency, Alignment, SD) %>% 
  summarize(count = n(),
            same_adjust = (sum(isSame)+0.5)/(count+1), # Snodgrass & Corwin (1988)
            .groups = "drop") %>% 
  mutate(z = qnorm(same_adjust)) %>% 
  select(-same_adjust) %>% 
  pivot_wider(names_from = "SD", values_from = z) %>% 
  mutate(d = sam - dif) %>% 
  pivot_wider(Subject, names_from = c(Congruency, Alignment), values_from = d) %>% 
  rename(isolated = iso_iso) %>% 
  mutate(fac_subt = con_ali - con_mis, # subtraction
         int_subt = inc_ali - inc_mis, # subtraction
         fac_subt_iso = con_ali - isolated, # subtraction
         int_subt_iso = inc_ali - isolated, # subtraction
         cong_ali_subt = con_ali - inc_ali, # subtraction
         cong_mis_subt = con_mis - inc_mis, # subtraction
         ccfe_subt = cong_ali_subt - cong_mis_subt) %>%  # subtraction
  cal_reg(con_ali ~ con_mis, fac_regr) %>% # regression
  cal_reg(inc_ali ~ inc_mis, int_regr) %>% # regression
  cal_reg(con_ali ~ isolated, fac_regr_iso) %>% # regression
  cal_reg(inc_ali ~ isolated, int_regr_iso) %>% # regression
  cal_reg(con_ali ~ inc_ali, cong_ali_regr) %>% # regression
  cal_reg(con_mis ~ inc_mis, cong_mis_regr) %>% # regression
  cal_reg(cong_ali_subt ~ cong_mis_subt, ccfe_subt_regr) %>% # regression
  cal_reg(cong_ali_regr ~ cong_mis_regr, ccfe_regr_regr) # regression

ccfe_d 
```

RT
```{r}
ccfe_rt <- df_ccf_iso %>% 
  filter(Correct) %>% 
  group_by(Subject, Congruency, Alignment) %>% 
  summarize(rt = mean(RT),
            .groups = "drop") %>% 
  pivot_wider(Subject, names_from = c(Congruency, Alignment), values_from = rt) %>% 
  rename(isolated = iso_iso) %>% 
  mutate(fac_subt = con_ali - con_mis, # subtraction
         int_subt = inc_ali - inc_mis, # subtraction
         fac_subt_iso = con_ali - isolated, # subtraction
         int_subt_iso = inc_ali - isolated, # subtraction
         cong_ali_subt = con_ali - inc_ali, # subtraction
         cong_mis_subt = con_mis - inc_mis, # subtraction
         ccfe_subt = cong_ali_subt - cong_mis_subt) %>% # subtraction
  cal_reg(con_ali ~ con_mis, fac_regr) %>% # regression
  cal_reg(inc_ali ~ inc_mis, int_regr) %>% # regression
  cal_reg(con_ali ~ isolated, fac_regr_iso) %>% # regression
  cal_reg(inc_ali ~ isolated, int_regr_iso) %>% # regression
  cal_reg(con_ali ~ inc_ali, cong_ali_regr) %>% # regression
  cal_reg(con_mis ~ inc_mis, cong_mis_regr) %>% # regression
  cal_reg(cong_ali_subt ~ cong_mis_subt, ccfe_subt_regr) %>% # regression [first step is subtraction; second step is regression]
  cal_reg(cong_ali_regr ~ cong_mis_regr, ccfe_regr_regr) # regression

ccfe_rt
```


## Reliability of measurement

`psych::splitHalf(..., check.keys=FALSE)` is used to calculate the Guttman's $\lambda_2$ (although it will report results of various methods). Thus, the data have to be prepared to fit the desired structure:

1. The average performance for each `StimGroup` and each participant (for each dependent variable in each task) will be calculated.
2. Then the data needs to be formatted as following, which will be completed later when calculating the reliability for each condition separately.  
- Each matrix is for one condition (and one dependent variable).  
- Each row of the matrix is for one participant.  
- Each column of the matrix is for one `StimGroup`.

```{r}
# a general (custom) function to calculate the reliability for each condition
rel_each <- function(.data, DV, ...){
  
  out <- 
    .data %>%
    filter(...) %>% # to filter out conditions
    pivot_wider(Subject, values_from = all_of(DV), names_from = StimGroup) %>% 
    select(-Subject) %>%
    data.matrix() %>%
    splitHalf(check.keys=FALSE)
  
  return(out$lambda2) # only output lambda2
}
```

```{r}
# function to calculate the reliability of subtraction scores
rel_sub <- function(re_inte, re_base, raw_inte, raw_base){
  
  # re_inte: the reliability of the condition of interest
  # re_base: the reliability of the baseline condition
  # raw_inte: the raw values for each participant in the condition of interest
  # raw_base: the raw values for each participant in the baseline condition
  
  tmp <- 2*sd(raw_inte)*sd(raw_base)*cor(raw_inte, raw_base)
  
  top <- var(raw_inte) * re_inte$Reliability + var(raw_base) * re_base$Reliability - tmp
  bot <- var(raw_inte) + var(raw_base) - tmp
  
  return(top/bot)
}

```

```{r}
# function to calculate the reliability of regression scores
rel_reg <- function(re_inte, re_base, raw_inte, raw_base){
  
  # re_inte: the reliability of the condition of interest
  # re_base: the reliability of the baseline condition
  # raw_inte: the raw values for each participant in the condition of interest
  # raw_base: the raw values for each participant in the baseline condition
  
  tmp1 <- cor(raw_inte, raw_base)^2
  
  top <- re_inte$Reliability + re_base$Reliability * tmp1 - 2 * tmp1
  bot <- 1 - tmp1
  
  return(top/bot)
}

```

```{r}
# function to calculate the upper boundary of the correlation
upper_boundary <- function(re1, re2){
  # reliability will be set to 0 if it is negative
  return(sqrt(max(re1$Reliability,0) * max(re2$Reliability,0)))
}
```


### Part-whole task

```{r}
# PW
df_pw_rel_acc <- df_pw %>%
  group_by(Subject, PW, StimGroup) %>% 
  summarize(acc = mean(Correct),
            .groups = "drop") 

df_pw_rel_rt <- df_pw %>%
  filter(Correct) %>% # only keep correct trials
  group_by(Subject, PW, StimGroup) %>% 
  summarize(rt = mean(RT),
            .groups = "drop") 
```

#### Reliability of each condition

Accuracy for whole
```{r}
rel_pw_acc_w <- rel_each(df_pw_rel_acc, "acc", PW=="whole") %>% 
  tibble(DV = "acc", Condition = "whole", Approach = "GuttmanL2",  Reliability = .)
rel_pw_acc_w
```

Accuracy for part
```{r}
rel_pw_acc_p <- rel_each(df_pw_rel_acc, "acc", PW=="part") %>% 
  tibble(DV = "acc", Condition = "part", Approach = "GuttmanL2", Reliability = .)
rel_pw_acc_p
```

RT for whole
```{r}
rel_pw_rt_w <- rel_each(df_pw_rel_rt, "rt", PW=="whole") %>% 
  tibble(DV = "rt", Condition = "whole", Approach = "GuttmanL2", Reliability = .)
rel_pw_rt_w
```

RT for part
```{r}
rel_pw_rt_p <- rel_each(df_pw_rel_rt, "rt", PW=="part") %>% 
  tibble(DV = "rt", Condition = "part", Approach = "GuttmanL2", Reliability = .)
rel_pw_rt_p
```

#### Reliability of the part-whole effect

Subtraction of accuracy
```{r}
rel_pwe_acc_subt <- rel_sub(rel_pw_acc_w, rel_pw_acc_p,
                            pwe_acc$whole, pwe_acc$part) %>% 
  tibble(DV = "acc", Condition = "whole - part", 
         Approach = "Subtraction", Reliability = .)
rel_pwe_acc_subt
```

Regression of accuracy
```{r}
rel_pwe_acc_regr <- rel_reg(rel_pw_acc_w, rel_pw_acc_p,
                            pwe_acc$whole, pwe_acc$part) %>% 
  tibble(DV = "acc", Condition = "whole ~ part", 
         Approach = "Regression", Reliability = .)
rel_pwe_acc_regr
```

Subtraction of RT
```{r}
rel_pwe_rt_subt <- rel_sub(rel_pw_rt_w, rel_pw_rt_p,
                           pwe_rt$whole, pwe_rt$part) %>% 
  tibble(DV = "rt", Condition = "whole - part", 
         Approach = "Subtraction", Reliability = .)
rel_pwe_rt_subt
```

Regression of RT
```{r}
rel_pwe_rt_regr <- rel_reg(rel_pw_rt_w, rel_pw_rt_p,
                           pwe_rt$whole, pwe_rt$part) %>% 
  tibble(DV = "rt", Condition = "whole ~ part", 
         Approach = "Regression", Reliability = .)
rel_pwe_rt_regr
```

#### Interim summary 

```{r}
rel_sum_pw <- bind_rows(rel_pw_acc_w, rel_pw_acc_p, rel_pw_rt_w, rel_pw_rt_p,
          rel_pwe_acc_subt, rel_pwe_acc_regr, rel_pwe_rt_subt, rel_pwe_rt_regr) %>% 
  mutate(Task="PW", .before=1)
rel_sum_pw
```

### Standard composite face task

```{r}  
# SCF
df_scf_rel_acc <- df_scf %>% 
  group_by(Subject, Alignment, StimGroup) %>% 
  summarize(acc = mean(Correct),
            .groups = "drop")

df_scf_rel_rt <- df_scf %>% 
  filter(Correct) %>% # only keep correct trials
  group_by(Subject, Alignment, StimGroup) %>% 
  summarize(rt = mean(RT),
            .groups = "drop")
```

#### Reliability of each condition
Accuracy for aligned
```{r}
rel_scf_acc_a <- rel_each(df_scf_rel_acc, "acc", Alignment=="ali") %>% 
  tibble(DV = "acc", Condition = "aligned", Approach = "GuttmanL2",  Reliability = .)
rel_scf_acc_a
```

Accuracy for misaligned
```{r}
rel_scf_acc_m <- rel_each(df_scf_rel_acc, "acc", Alignment=="mis") %>% 
  tibble(DV = "acc", Condition = "misaligned", Approach = "GuttmanL2",  Reliability = .)
rel_scf_acc_m
```

RT for aligned
```{r}
rel_scf_rt_a <- rel_each(df_scf_rel_rt, "rt", Alignment=="ali") %>% 
  tibble(DV = "rt", Condition = "aligned", Approach = "GuttmanL2",  Reliability = .)
rel_scf_rt_a
```

RT for misaligned
```{r}
rel_scf_rt_m <- rel_each(df_scf_rel_rt, "rt", Alignment=="mis") %>% 
  tibble(DV = "rt", Condition = "misaligned", Approach = "GuttmanL2",  Reliability = .)
rel_scf_rt_m
```

#### Reliability of the composite effect

Subtraction of accuracy
```{r}
rel_scfe_acc_subt <- rel_sub(rel_scf_acc_a, rel_scf_acc_m, 
                             scfe_acc$ali, scfe_acc$mis) %>% 
  tibble(DV = "acc", Condition = "ali - mis", 
         Approach = "Subtraction", Reliability = .)
rel_scfe_acc_subt
```

Regression of accuracy
```{r}
rel_scfe_acc_regr <- rel_reg(rel_scf_acc_a, rel_scf_acc_m, 
                             scfe_acc$ali, scfe_acc$mis) %>% 
  tibble(DV = "acc", Condition = "ali ~ mis", 
         Approach = "Regression", Reliability = .)
rel_scfe_acc_regr
```

Subtraction of RT
```{r}
rel_scfe_rt_subt <- rel_sub(rel_scf_rt_a, rel_scf_rt_m, 
                            scfe_rt$ali, scfe_rt$mis) %>% 
  tibble(DV = "rt", Condition = "ali - mis", 
         Approach = "Subtraction", Reliability = .)
rel_scfe_rt_subt
```

Regression of RT
```{r}
rel_scfe_rt_regr <- rel_reg(rel_scf_rt_a, rel_scf_rt_m, 
                            scfe_rt$ali, scfe_rt$mis) %>% 
  tibble(DV = "rt", Condition = "ali ~ mis", 
         Approach = "Regression", Reliability = .)
rel_scfe_rt_regr
```

#### Interim summary 

```{r}
rel_sum_scf <- bind_rows(rel_scf_acc_a, rel_scf_acc_m, rel_scf_rt_a, rel_scf_rt_m,
          rel_scfe_acc_subt, rel_scfe_acc_regr, rel_scfe_rt_subt, rel_scfe_rt_regr) %>% 
  mutate(Task = "SCF", .before =1)
rel_sum_scf
```

### Complete composite face task

```{r}
# CCF
df_ccf_rel_d <- df_ccf_iso %>% # need to include the isolated condition
  group_by(Subject, StimGroup, Congruency, Alignment, SD) %>% 
  summarize(count = n(),
            same_adjust = (sum(isSame)+0.5)/(count+1), # Snodgrass & Corwin (1988)
            .groups = "drop") %>% 
  mutate(z = qnorm(same_adjust)) %>% 
  select(-same_adjust) %>% 
  pivot_wider(names_from = "SD", values_from = z) %>% 
  mutate(d = sam - dif) %>% 
  select(Subject, Congruency, Alignment, StimGroup, d)

df_ccf_rel_rt <- df_ccf_iso %>% 
  filter(Correct) %>% 
  group_by(Subject, StimGroup, Congruency, Alignment) %>% 
  summarize(rt = mean(RT),
            .groups = "drop")
```


#### Reliability of congruency effects

Congruency in accuracy (aligned)
```{r}
rel_ccf_d_cong_a <- df_ccf_rel_d %>%
  filter(Alignment == "ali") %>% # to filter out conditions
  pivot_wider(c(Subject, StimGroup), values_from = d, names_from = Congruency) %>% 
  mutate(d_cong = con - inc) %>% 
  pivot_wider(Subject, values_from = d_cong, names_from = StimGroup) %>% 
  select(-Subject) %>% 
  data.matrix() %>%
  splitHalf(check.keys=FALSE) 

rel_ccf_d_cong_a <- rel_ccf_d_cong_a$lambda2 %>%  # only output lambda2
  tibble(DV = "d", Condition = "con_ali - inc_ali", 
         Approach = "GuttmanL2", Reliability = .)

rel_ccf_d_cong_a
```

Congruency in accuracy (misaligned)
```{r}
rel_ccf_d_cong_m <- df_ccf_rel_d %>%
  filter(Alignment == "mis") %>% # to filter out conditions
  pivot_wider(c(Subject, StimGroup), values_from = d, names_from = Congruency) %>% 
  mutate(d_cong = con - inc) %>% 
  pivot_wider(Subject, values_from = d_cong, names_from = StimGroup) %>% 
  select(-Subject) %>% 
  data.matrix() %>%
  splitHalf(check.keys=FALSE) 

rel_ccf_d_cong_m <- rel_ccf_d_cong_m$lambda2 %>%  # only output lambda2
  tibble(DV = "d", Condition = "con_mis - inc_mis", 
         Approach = "GuttmanL2", Reliability = .)

rel_ccf_d_cong_m
```

Congruency in RT (aligned)
```{r}
rel_ccf_rt_cong_a <- df_ccf_rel_rt %>%
  filter(Alignment == "ali") %>% # to filter out conditions
  pivot_wider(c(Subject, StimGroup), values_from = rt, names_from = Congruency) %>% 
  mutate(rt_cong = con - inc) %>% 
  pivot_wider(Subject, values_from = rt_cong, names_from = StimGroup) %>% 
  select(-Subject) %>% 
  data.matrix() %>%
  splitHalf(check.keys=FALSE) 

rel_ccf_rt_cong_a <- rel_ccf_rt_cong_a$lambda2 %>%  # only output lambda2
  tibble(DV = "rt", Condition = "con_ali - inc_ali", 
         Approach = "GuttmanL2", Reliability = .)

rel_ccf_rt_cong_a
```

Congruency in RT (misaligned)
```{r}
rel_ccf_rt_cong_m <- df_ccf_rel_rt %>%
  filter(Alignment == "mis") %>% # to filter out conditions
  pivot_wider(c(Subject, StimGroup), values_from = rt, names_from = Congruency) %>% 
  mutate(rt_cong = con - inc) %>% 
  pivot_wider(Subject, values_from = rt_cong, names_from = StimGroup) %>% 
  select(-Subject) %>% 
  data.matrix() %>%
  splitHalf(check.keys=FALSE) 

rel_ccf_rt_cong_m <- rel_ccf_rt_cong_m$lambda2 %>%  # only output lambda2
  tibble(DV = "rt", Condition = "con_mis - inc_mis", 
         Approach = "GuttmanL2", Reliability = .)

rel_ccf_rt_cong_m
```

#### Reliability of the composite effect

Subtraction of Congruency (composite effect) in d
```{r}
rel_ccfe_d_subt <- rel_sub(rel_ccf_d_cong_a, rel_ccf_d_cong_m, 
                           ccfe_d$cong_ali_subt, ccfe_d$cong_mis_subt) %>% 
  tibble(DV = "d", Condition = "(con_ali - inc_ali) - (con_mis - inc_mis)", 
         Approach = "Subtraction", Reliability = .)

rel_ccfe_d_subt
```

Regression of Congruency (composite effect) in d
```{r}
rel_ccfe_d_regr <- rel_reg(rel_ccf_d_cong_a, rel_ccf_d_cong_m, 
                           ccfe_d$cong_ali_subt, ccfe_d$cong_mis_subt) %>% 
  tibble(DV = "d", Condition = "(con_ali - inc_ali) ~ (con_mis - inc_mis)", 
         Approach = "Regression", Reliability = .)

rel_ccfe_d_regr
```

Subtraction of RT
```{r}
rel_ccfe_rt_subt <- rel_sub(rel_ccf_rt_cong_a, rel_ccf_rt_cong_m,
                            ccfe_rt$cong_ali_subt, ccfe_rt$cong_mis_subt) %>% 
  tibble(DV = "rt", Condition = "(con_ali - inc_ali) - (con_mis - inc_mis)", 
         Approach = "Subtraction", Reliability = .)

rel_ccfe_rt_subt
```

Regression of RT
```{r}
rel_ccfe_rt_regr <- rel_reg(rel_ccf_rt_cong_a, rel_ccf_rt_cong_m,
                            ccfe_rt$cong_ali_subt, ccfe_rt$cong_mis_subt) %>% 
  tibble(DV = "rt", Condition = "(con_ali - inc_ali) ~ (con_mis - inc_mis)", 
         Approach = "Regression", Reliability = .)

rel_ccfe_rt_regr
```

#### Reliability of each condition

d for congruent aligned
```{r}
rel_ccf_d_ca <- rel_each(df_ccf_rel_d, "d", 
                         Congruency=="con", Alignment=="ali") %>% 
  tibble(DV = "d", Condition = "con_ali", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_d_ca
```

d for incongruent aligned
```{r}
rel_ccf_d_ia <- rel_each(df_ccf_rel_d, "d", 
                         Congruency=="inc", Alignment=="ali") %>% 
  tibble(DV = "d", Condition = "inc_ali", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_d_ia
```

d for congruent misaligned
```{r}
rel_ccf_d_cm <- rel_each(df_ccf_rel_d, "d", 
                         Congruency=="con", Alignment=="mis") %>% 
  tibble(DV = "d", Condition = "con_mis", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_d_cm
```

d for incongruent misaligned
```{r}
rel_ccf_d_im <- rel_each(df_ccf_rel_d, "d", 
                         Congruency=="inc", Alignment=="mis") %>% 
  tibble(DV = "d", Condition = "inc_mis", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_d_im
```

d for isolated
```{r}
rel_ccf_d_iso <- rel_each(df_ccf_rel_d, "d", 
                          Congruency=="iso", Alignment=="iso") %>% 
  tibble(DV = "d", Condition = "isolated", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_d_iso
```

RT for congruent aligned
```{r}
rel_ccf_rt_ca <- rel_each(df_ccf_rel_rt, "rt", 
                          Congruency=="con", Alignment=="ali") %>% 
  tibble(DV = "rt", Condition = "con_ali", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_rt_ca
```

RT for incongruent aligned
```{r}
rel_ccf_rt_ia <- rel_each(df_ccf_rel_rt, "rt", 
                          Congruency=="inc", Alignment=="ali") %>% 
  tibble(DV = "rt", Condition = "inc_ali", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_rt_ia
```

RT for congruent misaligned
```{r}
rel_ccf_rt_cm <- rel_each(df_ccf_rel_rt, "rt", 
                          Congruency=="con", Alignment=="mis") %>% 
  tibble(DV = "rt", Condition = "con_mis", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_rt_cm
```

RT for incongruent misaligned
```{r}
rel_ccf_rt_im <- rel_each(df_ccf_rel_rt, "rt", 
                          Congruency=="inc", Alignment=="mis") %>% 
  tibble(DV = "rt", Condition = "inc_mis", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_rt_im
```

RT for isolated
```{r}
rel_ccf_rt_iso <- rel_each(df_ccf_rel_rt, "rt", 
                           Congruency=="iso", Alignment=="iso") %>% 
  tibble(DV = "rt", Condition = "isolated", 
         Approach = "GuttmanL2",  Reliability = .)
rel_ccf_rt_iso
```


#### Reliability of facilitation

Subtraction of accuracy (with isolated baselines)
```{r}
rel_fac_d_iso_subt <- rel_sub(rel_ccf_d_ca, rel_ccf_d_iso, 
                              ccfe_d$con_ali, ccfe_d$isolated) %>% 
  tibble(DV = "d", Condition = "con_ali - isolated", 
         Approach = "Subtraction",  Reliability = .)

rel_fac_d_iso_subt
```

Regression of accuracy (with isolated baselines)
```{r}
rel_fac_d_iso_regr <- rel_reg(rel_ccf_d_ca, rel_ccf_d_iso, 
                              ccfe_d$con_ali, ccfe_d$isolated) %>% 
  tibble(DV = "d", Condition = "con_ali ~ isolated", 
         Approach = "Regression",  Reliability = .)

rel_fac_d_iso_regr
```

Subtraction of RT (with isolated baselines)
```{r}
rel_fac_rt_iso_subt <- rel_sub(rel_ccf_rt_ca, rel_ccf_rt_iso, 
                               ccfe_rt$con_ali, ccfe_rt$isolated) %>% 
  tibble(DV = "rt", Condition = "con_ali - isolated", 
         Approach = "Subtraction",  Reliability = .)

rel_fac_rt_iso_subt
```

Regression of RT (with isolated baselines)
```{r}
rel_fac_rt_iso_regr <- rel_reg(rel_ccf_rt_ca, rel_ccf_rt_iso, 
                               ccfe_rt$con_ali, ccfe_rt$isolated) %>% 
  tibble(DV = "rt", Condition = "con_ali ~ isolated", 
         Approach = "Regression",  Reliability = .)

rel_fac_rt_iso_regr
```

Subtraction of accuracy (with misaligned baselines)
```{r}
rel_fac_d_subt <- rel_sub(rel_ccf_d_ca, rel_ccf_d_cm, 
                          ccfe_d$con_ali, ccfe_d$con_mis) %>% 
  tibble(DV = "d", Condition = "con_ali - con_mis", 
         Approach = "Subtraction",  Reliability = .)

rel_fac_d_subt
```

Regression of accuracy (with misaligned baselines)
```{r}
rel_fac_d_regr <- rel_reg(rel_ccf_d_ca, rel_ccf_d_cm, 
                          ccfe_d$con_ali, ccfe_d$con_mis) %>% 
  tibble(DV = "d", Condition = "con_ali ~ con_mis", 
         Approach = "Regression",  Reliability = .)

rel_fac_d_regr
```

Subtraction of RT (with misaligned baselines)
```{r}
rel_fac_rt_subt <- rel_sub(rel_ccf_rt_ca, rel_ccf_rt_cm, 
                           ccfe_rt$con_ali, ccfe_rt$con_mis) %>% 
  tibble(DV = "rt", Condition = "con_ali - con_mis", 
         Approach = "Subtraction",  Reliability = .)

rel_fac_rt_subt
```

Regression of RT (with misaligned baselines)
```{r}
rel_fac_rt_regr <- rel_reg(rel_ccf_rt_ca, rel_ccf_rt_cm, 
                           ccfe_rt$con_ali, ccfe_rt$con_mis) %>% 
  tibble(DV = "rt", Condition = "con_ali ~ con_mis", 
         Approach = "Regression",  Reliability = .)

rel_fac_rt_subt
```


#### Reliability of interference

Subtraction of d (with isolated baselines)
```{r}
rel_int_d_iso_subt <- rel_sub(rel_ccf_d_ia, rel_ccf_d_iso, 
                              ccfe_d$inc_ali, ccfe_d$isolated) %>% 
  tibble(DV = "d", Condition = "inc_ali - isolated", 
         Approach = "Subtraction",  Reliability = .)

rel_int_d_iso_subt
```

Regression of d (with isolated baselines)
```{r}
rel_int_d_iso_regr <- rel_reg(rel_ccf_d_ia, rel_ccf_d_iso,
                              ccfe_d$inc_ali, ccfe_d$isolated) %>% 
  tibble(DV = "d", Condition = "inc_ali ~ isolated", 
         Approach = "Regression",  Reliability = .)

rel_int_d_iso_regr
```

Subtraction of RT (with isolated baselines)
```{r}
rel_int_rt_iso_subt <- rel_sub(rel_ccf_rt_ia, rel_ccf_rt_iso, 
                               ccfe_rt$inc_ali, ccfe_rt$isolated) %>% 
  tibble(DV = "rt", Condition = "inc_ali - isolated", 
         Approach = "Subtraction",  Reliability = .)

rel_int_rt_iso_subt
```

Regression of RT (with isolated baselines)
```{r}
rel_int_rt_iso_regr <- rel_reg(rel_ccf_rt_ia, rel_ccf_rt_iso, 
                               ccfe_rt$inc_ali, ccfe_rt$isolated) %>% 
  tibble(DV = "rt", Condition = "inc_ali ~ isolated", 
         Approach = "Regression",  Reliability = .)

rel_int_rt_iso_regr
```

Subtraction of d (with misaligned baselines)
```{r}
rel_int_d_subt <- rel_sub(rel_ccf_d_ia, rel_ccf_d_im, 
                          ccfe_d$inc_ali, ccfe_d$inc_mis) %>% 
  tibble(DV = "d", Condition = "inc_ali - inc_mis", 
         Approach = "Subtraction",  Reliability = .)

rel_int_d_subt
```

Regression of d (with misaligned baselines)
```{r}
rel_int_d_regr <- rel_reg(rel_ccf_d_ia, rel_ccf_d_im,
                          ccfe_d$inc_ali, ccfe_d$inc_mis) %>% 
  tibble(DV = "d", Condition = "inc_ali ~ inc_mis", 
         Approach = "Regression",  Reliability = .)

rel_int_d_regr
```

Subtraction of RT (with misaligned baselines)
```{r}
rel_int_rt_subt <- rel_sub(rel_ccf_rt_ia, rel_ccf_rt_im, 
                           ccfe_rt$inc_ali, ccfe_rt$inc_mis) %>% 
  tibble(DV = "rt", Condition = "inc_ali - inc_mis", 
         Approach = "Subtraction",  Reliability = .)

rel_int_rt_subt
```

Regression of RT (with misaligned baselines)
```{r}
rel_int_rt_regr <- rel_reg(rel_ccf_rt_ia, rel_ccf_rt_im, 
                           ccfe_rt$inc_ali, ccfe_rt$inc_mis) %>% 
  tibble(DV = "rt", Condition = "inc_ali ~ inc_mis", 
         Approach = "Regression",  Reliability = .)

rel_int_rt_regr
```

#### Interim summary 

```{r}
bind_rows(rel_ccf_d_ca, rel_ccf_d_ia, rel_ccf_d_cm, rel_ccf_d_im, rel_ccf_d_iso, # each condition
          rel_ccf_rt_ca, rel_ccf_rt_ia, rel_ccf_rt_cm, rel_ccf_rt_im, rel_ccf_rt_iso, # each condition
          rel_ccf_d_cong_a, rel_ccf_d_cong_m, rel_ccf_rt_cong_a, rel_ccf_rt_cong_m, # congruency effects
          rel_ccfe_d_subt, rel_ccfe_d_regr, rel_ccfe_rt_subt, rel_ccfe_rt_regr, # composite effects
          rel_fac_d_iso_subt, rel_fac_d_iso_regr, rel_fac_rt_iso_subt, rel_fac_rt_iso_regr, # facilitation (isolated)
          rel_fac_d_subt, rel_fac_d_regr, rel_fac_rt_subt, rel_fac_rt_regr, # facilitation 
          rel_int_d_iso_subt, rel_int_d_iso_regr, rel_int_rt_iso_subt, rel_int_rt_iso_regr, # interference (isolated)
          rel_int_d_subt, rel_int_d_regr, rel_int_rt_subt, rel_int_rt_regr # interference 
) %>% 
  mutate(Task = "CCF", .before=1)
```


## Correlations among holistic processing effects

```{r}
# custom function to print the two-sided correlation results via library(psych)
psych_cor2 <- function(.data, ...) {
  
  # .data: data frame only includes columns for correlation (no subject code column)
  # Usage: psych_cor2(hpe_acc_subt)
  
  # run correlations
  cor_tmp <- psych::corr.test(.data, ...)
  
  cor_tmp$ci %>% 
    rename(`lower95`=lower,
           `upper95`=upper) %>% 
    mutate(N = cor_tmp$n,
           p.adj = cor_tmp$p.adj,
           adjust = cor_tmp$adjust,
           alt = "two.sided") %>% 
    bind_cols(cor_tmp$ci.adj %>% mutate(r=1) %>% select(-r)) %>% 
    return()
}
```

```{r}
# custom function to calculate CI with r and n
r2ci <- function(r, n){
  cormatrix <- matrix(c(r), nrow=1)
  rownames(cormatrix) <- c("var1")
  colnames(cormatrix) <- c("var1")
  
  out <- psych::corr.p(cormatrix, n, "none") 
  
  return(out$ci)
}
```


### Equivalence tests

```{r}
# equivalence interval
delta_null_hp <- .15  # the equivalent interval will be [-delta_null_hp, delta_null_hp]

df_equi_hp <- tibble(
  Scenarios = paste("Scenario", 1:6),
  CI_low = c(delta_null_hp-.05, -delta_null_hp-.08, -delta_null_hp+.02, -.04, -delta_null_hp-.04, -delta_null_hp-.02),
  CI_upp = CI_low + c(rep(0.2, 5), 0.34)
) %>% 
  mutate(Scenarios = factor(Scenarios),
         Scenarios = factor(Scenarios, levels = rev(levels(Scenarios))))

plot_equi_hp <- ggplot(df_equi_hp, aes(xmin = CI_low, xmax = CI_upp, y = Scenarios)) +
  geom_errorbarh(height = .4, color = c("#D55E00", "#D55E00", "#56B4E9",
                                        "gray30", "gray30", "gray30"), size = 1) +  # , "gray30"
  geom_vline(xintercept = 0, linetype = "longdash") +
  geom_vline(xintercept = c(-delta_null_hp,delta_null_hp), linetype = "dashed", color = "gray30") +
  scale_x_continuous(limits = c(-.3, .3), breaks = c(-delta_null_hp, 0, delta_null_hp)) +
  xlab("Correlation coefficient") +
  papaja::theme_apa() +
  NULL

# ggsave("equivalence_test_hp.png", plot_equi_hp, width = 8, height = 5)

plot_equi_hp
```

```{r}
# custom function to employ TOSTr
equi_r2 <- function(.data, low_eqbound_r, high_eqbound_r, ...){
  
  # .data (same as that in psych_cor2()); 
  #       data frame only includes columns for correlation (no subject code column)
  
  corr_mat <- psych_cor2(.data)
  
  r <- c()
  tost_pmax <- c()
  tost_lw <- c()
  tost_hi <- c()
  
  for (irow in 1:nrow(corr_mat)) {
    
    thisr <- corr_mat[irow,]
    
    tmp <- TOSTr(thisr$N, thisr$r, low_eqbound_r, high_eqbound_r, 
                 plot = FALSE, verbose = FALSE, ...)
    
    r[irow] <- tmp$r
    tost_pmax[irow] <- max(tmp$TOST_p1, tmp$TOST_p2)
    tost_lw[irow] <- tmp$LL_CI_TOST
    tost_hi[irow] <- tmp$UL_CI_TOST
  }
  
  equir_out <- data.frame(r = r,
                          tost_pmax = tost_pmax,
                          tost_lw90 = tost_lw,
                          tost_up90 = tost_hi,
                          low_eqbound_r = low_eqbound_r,
                          high_eqbound_r = high_eqbound_r)
  
  rownames(equir_out) <- rownames(corr_mat)
  
  return(equir_out)
}

```


### Subtraction

```{r}
hpe_acc_subt <- pwe_acc %>% 
  inner_join(scfe_acc, by="Subject") %>% 
  inner_join(ccfe_d, by="Subject") %>% 
  transmute(pwe_subt, scfe_subt=-scfe_subt, ccfe_subt) 

hpe_rt_subt <- pwe_rt %>% 
  inner_join(scfe_rt, by="Subject") %>% 
  inner_join(ccfe_rt, by="Subject") %>% 
  transmute(pwe_subt, scfe_subt=-scfe_subt, ccfe_subt)
```

Accuracy
```{r}
corPlot(hpe_acc_subt)
```

Correlations among holistic processing effects of accuracy (subtraction)
```{r}
psych_cor2(hpe_acc_subt) %>% 
  mutate(up_bound = c(
    upper_boundary(rel_pwe_acc_subt, rel_scfe_acc_subt),
    upper_boundary(rel_pwe_acc_subt, rel_ccfe_d_subt),
    upper_boundary(rel_scfe_acc_subt, rel_ccfe_d_subt)
  ), .before = 1)
```

Correlations (equivalence tests) among holistic processing effects of accurac (subtraction)
```{r}
equi_r2(hpe_acc_subt, -equi_boundary, equi_boundary)
```

RT
```{r}
corPlot(hpe_rt_subt)
```

Correlations among holistic processing effects of RT (subtraction)
```{r}
psych_cor2(hpe_rt_subt) %>% 
  mutate(up_bound = c(
    upper_boundary(rel_pwe_rt_subt, rel_scfe_rt_subt),
    upper_boundary(rel_pwe_rt_subt, rel_ccfe_rt_subt),
    upper_boundary(rel_scfe_rt_subt, rel_ccfe_rt_subt)
  ), .before = 1)
```

Correlations (equivalence tests) among holistic processing effects of RT (subtraction)
```{r}
equi_r2(hpe_rt_subt, -equi_boundary, equi_boundary)
```

### Regression

```{r}
hpe_acc_regr <- pwe_acc %>% 
  inner_join(scfe_acc, by="Subject") %>% 
  inner_join(ccfe_d, by="Subject") %>% 
  transmute(pwe_regr, scfe_regr=-scfe_regr, ccfe_subt_regr)

hpe_rt_regr <- pwe_rt %>% 
  inner_join(scfe_rt, by="Subject") %>% 
  inner_join(ccfe_rt, by="Subject") %>% 
  transmute(pwe_regr, scfe_regr=-scfe_regr, ccfe_subt_regr)
```

Accuracy
```{r}
corPlot(hpe_acc_regr)
```

Correlations among holistic processing effects of accuracy (regression)
```{r}
psych_cor2(hpe_acc_regr) %>% 
  mutate(up_bound = c(
    upper_boundary(rel_pwe_acc_regr, rel_scfe_acc_regr),
    upper_boundary(rel_pwe_acc_regr, rel_ccfe_d_regr),
    upper_boundary(rel_scfe_acc_regr, rel_ccfe_d_regr)
  ), .before = 1)
```

Correlations (equivalence tests) among holistic processing effects of accuracy (regression)
```{r}
equi_r2(hpe_acc_regr, -equi_boundary, equi_boundary)
```

RT
```{r}
corPlot(hpe_rt_regr)
```

Correlations among holistic processing effects of RT (regression)
```{r}
psych_cor2(hpe_rt_regr) %>% 
  mutate(up_bound = c(
    upper_boundary(rel_pwe_rt_regr, rel_scfe_rt_regr),
    upper_boundary(rel_pwe_rt_regr, rel_ccfe_rt_regr),
    upper_boundary(rel_scfe_rt_regr, rel_ccfe_rt_regr)
  ), .before = 1)
```

Correlations (equivalence tests) among holistic processing effects of RT (regression)
```{r}
equi_r2(hpe_rt_regr, -equi_boundary, equi_boundary)
```


## Correlations for facilitation and interference

```{r}
# custom function to print the two-sided correlation results via library(psych)
psych_cor1 <- function(x, y, ...) {
  
  # .data: data frame only includes columns for correlation (no subject code column)
  # Usage: psych_cor1(hpe_acc_subt)
  
  # run correlations
  cor_tmp <- psych::corr.test(x, y, alpha=.1, ...) # one-sided test
  
  rownames(cor_tmp) <- NULL
  
  cor_tmp$ci %>% 
    rename(`lower90`=lower,
           `upper90`=upper) %>% 
    mutate(N = cor_tmp$n,
           p = p/2,
           alt = "greater") %>% 
    # bind_cols(cor_tmp$ci.adj %>% mutate(r=1) %>% select(-r)) %>% 
    return()
}
```

### Equivalence tests (one-sided)

```{r}
# equivalence interval
delta_null <- .15  # the equivalent interval will be [-delta_null, delta_null]

df_equi <- tibble(
  Scenarios = paste("Scenario", 1:7),
  CI_low = c(delta_null+.02, delta_null-.1, .03, -delta_null+.05, -.14, -delta_null-.03, -.05),
  CI_upp = CI_low + c(.2, .2, 0.1, .2, 0.1, .3, .3)
) %>% 
  mutate(Scenarios = factor(Scenarios),
         Scenarios = factor(Scenarios, levels = rev(levels(Scenarios))))

plot_equi <- ggplot(df_equi, aes(xmin = CI_low, xmax = CI_upp, y = Scenarios)) +
  geom_errorbarh(height = .4, color = c("#D55E00", "#D55E00", "#D55E00",
                                        "#56B4E9", "#56B4E9", "#56B4E9", "gray30"), size = 1) + 
  geom_vline(xintercept = 0, linetype = "longdash") +
  geom_vline(xintercept = delta_null, linetype = "dashed", color = "gray30") +
  scale_x_continuous(limits = c(-.25, .4), breaks = c(-delta_null, 0, delta_null)) +
  xlab("Correlation coefficient") +
  papaja::theme_apa() +
  NULL

# ggsave("equivalence_test.png", plot_equi, width = 8, height = 5)

plot_equi
```

```{r}
# custom function to employ TOSTr
equi_small_r1 <- function(x, y, high_eqbound_r, low_eqbound_r = -1, ...){
  
  # .data (same as that in psych_cor2()); 
  #       data frame only includes columns for correlation (no subject code column)
  
  corr_mat <- psych_cor2(x, y)
  
  tmp <- TOSTr(corr_mat$N, corr_mat$r, low_eqbound_r, high_eqbound_r, 
               plot = FALSE, verbose = FALSE, ...)
  
  equir_out <- data.frame(r = tmp$r,
                          tost_pmax = max(tmp$TOST_p1, tmp$TOST_p2),
                          tost_lw90 = tmp$LL_CI_TOST,
                          tost_up90 = tmp$UL_CI_TOST,
                          low_eqbound_r = low_eqbound_r,
                          high_eqbound_r = high_eqbound_r)
  
  return(equir_out)
}
```

### PW and Facilitation in CCF

#### Subtraction

accuracy 
```{r}
r_pwe_fac_acc_subt <- psych_cor1(pwe_acc$pwe_subt, ccfe_d$fac_subt) %>% 
  mutate(pair = "pwe_subt ~ fac_subt",
         DV = "acc",
         up_bound = upper_boundary(rel_pwe_acc_subt, rel_fac_d_subt),
         .before = 1)
rownames(r_pwe_fac_acc_subt) <- NULL
r_pwe_fac_acc_subt
```

```{r}
equi_small_r1(pwe_acc$pwe_subt, ccfe_d$fac_subt, equi_boundary, -equi_boundary)
```

accuracy isolated
```{r}
r_pwe_fac_iso_acc_subt <- psych_cor1(pwe_acc$pwe_subt, ccfe_d$fac_subt_iso) %>% 
  mutate(pair = "pwe_subt ~ fac_subt_iso",
         DV = "acc",
         up_bound = upper_boundary(rel_pwe_acc_subt, rel_fac_d_iso_subt),
         .before = 1)
rownames(r_pwe_fac_iso_acc_subt) <- NULL
r_pwe_fac_iso_acc_subt
```

```{r}
equi_small_r1(pwe_acc$pwe_subt, ccfe_d$fac_subt_iso, equi_boundary, -equi_boundary)
```

RT 
```{r}
r_pwe_fac_rt_subt <- psych_cor1(pwe_rt$pwe_subt, ccfe_rt$fac_subt) %>% 
  mutate(pair = "pwe_subt ~ fac_subt",
         DV = "rt", 
         up_bound = upper_boundary(rel_pwe_rt_subt, rel_fac_rt_subt),
         .before = 1)
rownames(r_pwe_fac_rt_subt) <- NULL
r_pwe_fac_rt_subt
```

```{r}
equi_small_r1(pwe_rt$pwe_subt, ccfe_rt$fac_subt, equi_boundary, -equi_boundary)
```

RT isolated
```{r}
r_pwe_fac_iso_rt_subt <- psych_cor1(pwe_rt$pwe_subt, ccfe_rt$fac_subt_iso) %>% 
  mutate(pair = "pwe_subt ~ fac_subt_iso",
         DV = "rt", 
         up_bound = upper_boundary(rel_pwe_rt_subt, rel_fac_rt_iso_subt),
         .before = 1)
rownames(r_pwe_fac_iso_rt_subt) <- NULL
r_pwe_fac_iso_rt_subt
```

```{r}
equi_small_r1(pwe_rt$pwe_subt, ccfe_rt$fac_subt_iso, equi_boundary, -equi_boundary)
```

#### Regressions
Accuracy
```{r}
r_pwe_fac_acc_regr <- psych_cor1(pwe_acc$pwe_regr, ccfe_d$fac_regr) %>% 
  mutate(pair = "pwe_regr ~ fac_regr",
         DV = "acc", 
         up_bound = upper_boundary(rel_pwe_acc_regr, rel_fac_d_regr),
         .before = 1)
rownames(r_pwe_fac_acc_regr) <- NULL
r_pwe_fac_acc_regr
```

```{r}
equi_small_r1(pwe_acc$pwe_regr, ccfe_d$fac_regr, equi_boundary, -equi_boundary)
```

Accuracy isolated
```{r}
r_pwe_fac_iso_acc_regr <- psych_cor1(pwe_acc$pwe_regr, ccfe_d$fac_regr_iso) %>% 
  mutate(pair = "pwe_regr ~ fac_regr_iso",
         DV = "acc", 
         up_bound = upper_boundary(rel_pwe_acc_regr, rel_fac_d_iso_regr),
         .before = 1)
rownames(r_pwe_fac_iso_acc_regr) <- NULL
r_pwe_fac_iso_acc_regr
```

```{r}
equi_small_r1(pwe_acc$pwe_regr, ccfe_d$fac_regr_iso, equi_boundary, -equi_boundary)
```

RT 
```{r}
r_pwe_fac_rt_regr <- psych_cor1(pwe_rt$pwe_regr, ccfe_rt$fac_regr) %>% 
  mutate(pair = "pwe_regr ~ fac_regr",
         DV = "rt", 
         up_bound = upper_boundary(rel_pwe_rt_regr, rel_fac_rt_regr),
         .before = 1)
rownames(r_pwe_fac_rt_regr) <- NULL
r_pwe_fac_rt_regr
```

```{r}
equi_small_r1(pwe_rt$pwe_regr, ccfe_rt$fac_regr, equi_boundary, -equi_boundary)
```

RT isolated
```{r}
r_pwe_fac_iso_rt_regr <- psych_cor1(pwe_rt$pwe_regr, ccfe_rt$fac_regr_iso) %>% 
  mutate(pair = "pwe_regr ~ fac_regr_iso",
         DV = "rt", 
         up_bound = upper_boundary(rel_pwe_rt_regr, rel_fac_rt_iso_regr),
         .before = 1)
rownames(r_pwe_fac_iso_rt_regr) <- NULL
r_pwe_fac_iso_rt_regr
```

```{r}
equi_small_r1(pwe_rt$pwe_regr, ccfe_rt$fac_regr_iso, equi_boundary, -equi_boundary)
```

#### Interim summary

```{r}
bind_rows(r_pwe_fac_acc_subt, r_pwe_fac_iso_acc_subt,
          r_pwe_fac_rt_subt, r_pwe_fac_iso_rt_subt,
          r_pwe_fac_acc_regr, r_pwe_fac_iso_acc_regr,
          r_pwe_fac_rt_regr, r_pwe_fac_iso_rt_regr) %>% 
  mutate(p_cor = p.adjust(p, method = "holm")) # apply Holm-Bonferroni
```

### SCF and Interference in CCF

#### Subtraction
Accuracy
```{r}
r_scfe_int_acc_subt <- psych_cor1(scfe_acc$scfe_subt, ccfe_d$int_subt) %>% 
  mutate(pair = "scfe_subt ~ int_subt",
         DV = "acc",
         up_bound = upper_boundary(rel_scfe_acc_subt, rel_int_d_subt),
         .before = 1)
r_scfe_int_acc_subt
```

```{r}
equi_small_r1(scfe_acc$scfe_subt, ccfe_d$int_subt, equi_boundary, -equi_boundary)
```

Accuracy isolated
```{r}
r_scfe_int_iso_acc_subt <- psych_cor1(scfe_acc$scfe_subt, ccfe_d$int_subt_iso) %>% 
  mutate(pair = "scfe_subt ~ int_subt_iso",
         DV = "acc",
         up_bound = upper_boundary(rel_scfe_acc_subt, rel_int_d_iso_subt),
         .before = 1)
r_scfe_int_iso_acc_subt
```

```{r}
equi_small_r1(scfe_acc$scfe_subt, ccfe_d$int_subt_iso, equi_boundary, -equi_boundary)
```

RT 
```{r}
r_scfe_int_rt_subt <- psych_cor1(scfe_rt$scfe_subt, ccfe_rt$int_subt) %>% 
  mutate(pair = "scfe_subt ~ int_subt",
         DV = "rt",
         up_bound = upper_boundary(rel_scfe_rt_subt, rel_int_rt_subt),
         .before = 1)
r_scfe_int_rt_subt
```

```{r}
equi_small_r1(scfe_rt$scfe_subt, ccfe_rt$int_subt, equi_boundary, -equi_boundary)
```

RT isolated
```{r}
r_scfe_int_iso_rt_subt <- psych_cor1(scfe_rt$scfe_subt, ccfe_rt$int_subt_iso) %>% 
  mutate(pair = "scfe_subt ~ int_subt_iso",
         DV = "acc",
         up_bound = upper_boundary(rel_scfe_rt_subt, rel_int_rt_iso_subt),
         .before = 1)
r_scfe_int_iso_rt_subt
```

```{r}
equi_small_r1(scfe_rt$scfe_subt, ccfe_rt$int_subt_iso, equi_boundary, -equi_boundary)
```

#### Regressions
Accuracy
```{r}
r_scfe_int_acc_regr <- psych_cor1(scfe_acc$scfe_regr, ccfe_d$int_regr) %>% 
  mutate(pair = "scfe_regr ~ int_regr",
         DV = "acc",
         up_bound = upper_boundary(rel_scfe_acc_regr, rel_int_d_regr),
         .before = 1)
r_scfe_int_acc_regr
```

```{r}
equi_small_r1(scfe_acc$scfe_regr, ccfe_d$int_regr, equi_boundary, -equi_boundary)
```

Accuracy isolated
```{r}
r_scfe_int_iso_acc_regr <- psych_cor1(scfe_acc$scfe_regr, ccfe_d$int_regr_iso) %>% 
  mutate(pair = "scfe_regr ~ int_regr_iso",
         DV = "acc",
         up_bound = upper_boundary(rel_scfe_acc_regr, rel_int_d_iso_regr),
         .before = 1)
r_scfe_int_iso_acc_regr
```

```{r}
equi_small_r1(scfe_acc$scfe_regr, ccfe_d$int_regr_iso, equi_boundary, -equi_boundary)
```

RT
```{r}
r_scfe_int_rt_regr <- psych_cor1(scfe_rt$scfe_regr, ccfe_rt$int_regr) %>% 
  mutate(pair = "scfe_regr ~ int_regr",
         DV = "rt",
         up_bound = upper_boundary(rel_scfe_rt_regr, rel_int_rt_regr),
         .before = 1)
r_scfe_int_rt_regr
```

```{r}
equi_small_r1(scfe_rt$scfe_regr, ccfe_rt$int_regr, equi_boundary, -equi_boundary)
```

RT isolated
```{r}
r_scfe_int_iso_rt_regr <- psych_cor1(scfe_rt$scfe_regr, ccfe_rt$int_regr_iso) %>% 
  mutate(pair = "scfe_regr ~ int_regr_iso",
         DV = "rt",
         up_bound = upper_boundary(rel_scfe_rt_regr, rel_int_rt_iso_regr),
         .before = 1)
r_scfe_int_iso_rt_regr
```

```{r}
equi_small_r1(scfe_rt$scfe_regr, ccfe_rt$int_regr_iso, equi_boundary, -equi_boundary)
```

#### Interim summary

```{r}
bind_rows(r_scfe_int_acc_subt, r_scfe_int_iso_acc_subt,
          r_scfe_int_rt_subt, r_scfe_int_iso_rt_subt,
          r_scfe_int_acc_regr, r_scfe_int_iso_acc_regr,
          r_scfe_int_rt_regr, r_scfe_int_iso_rt_regr) %>% 
  mutate(p_cor = p.adjust(p, method = "holm")) # apply Holm-Bonferroni
```

## Pairwise correlations (exploratory)

### Behavioral choices

```{r fig.width=7, fig.asp=1}
pwe_acc %>% 
  inner_join(scfe_acc, by="Subject") %>% 
  inner_join(ccfe_d, by="Subject") %>% 
  select(-Subject, -contains("regr")) %>% 
  cor.plot()
```

```{r fig.width=7, fig.asp=1}
pwe_acc %>% 
  inner_join(scfe_acc, by="Subject") %>% 
  inner_join(ccfe_d, by="Subject") %>% 
  select(-Subject, -contains("subt"), ccfe_subt_regr) %>% 
  cor.plot()
```

### Response times

```{r}
pwe_rt %>% 
  left_join(scfe_rt, by="Subject") %>% 
  left_join(ccfe_rt, by="Subject") %>% 
  select(-Subject, -contains("regr")) %>% 
  cor.plot()
```

```{r}
pwe_rt %>% 
  left_join(scfe_rt, by="Subject") %>% 
  left_join(ccfe_rt, by="Subject") %>% 
  select(-Subject, -contains("subt"), ccfe_subt_regr) %>% 
  cor.plot()
```

